<div class="conatiner px-2">
    <div class="row">
        <div class="col pb-4">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-6 col-lg-3">
                            <div class="d-flex justify-content-between border-end p-2">
                                <div>
                                    <h2 class="mb-0 fw-medium fs-4">{{paidQty}}</h2>
                                    <p class="mb-0">Paid</p>
                                </div>
                                <div class="avatar p-2">
                                    <span class="avatar-initial rounded bg-paid">
                                        <i class="bi bi-receipt-cutoff fs-4"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-lg-3">
                            <div class="d-flex justify-content-between border-end p-2">
                                <div>
                                    <h2 class="mb-0 fw-medium fs-4">{{unpaidQty}}</h2>
                                    <p class="mb-0">Unpaid</p>
                                </div>
                                <div class="avatar p-2">
                                    <span class="avatar-initial rounded bg-unpaid">
                                        <i class="bi bi-receipt fs-4"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-lg-3 d-none d-md-block">
                            <div class="d-flex justify-content-between border-end p-2">
                                <div>
                                    <h2 class="mb-0 fw-medium fs-4">${{paidTotal | number:'1.2-2'}}</h2>
                                    <p class="mb-0">Paid</p>
                                </div>
                                <div class="avatar p-2">
                                    <span class="avatar-initial rounded bg-paid">
                                        <i class="bi bi-bank fs-4"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-6 col-lg-3 d-none d-md-block">
                            <div class="d-flex justify-content-between p-2">
                                <div>
                                    <h2 class="mb-0 fw-medium fs-4">${{unpaidTotal | number:'1.2-2'}}</h2>
                                    <p class="mb-0">Unpaid</p>
                                </div>
                                <div class="avatar p-2">
                                    <span class="avatar-initial rounded bg-unpaid">
                                        <i class="bi bi-currency-dollar fs-4"></i>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col pb-4">
            <div class="card">
                <div class="card-body pb-2">
                    <div class="d-flex align-items-center justify-content-between pt-2">
                        <form class="mx-2" style="position: relative;">
                            <input type="text" class="form-control" id="searchInvoice" placeholder="Search Invoice"
                                matInput (keyup)="applyFilter($event)" #input>

                            <span id="clearButton" class="clearBtn hoverColor"><i class="bi bi-x-lg"></i></span>
                        </form>

                        <form [formGroup]="filterFormInputs">
                            <div class="row">
                                <div class="col px-2 d-none d-md-block">
                                    <select class="form-select" formControlName="status" (change)="filterStatus()">
                                        <option value="-1" selected>Status All</option>
                                        <option value="Paid">Paid</option>
                                        <option value="Partial">Partial</option>
                                        <option value="Past Due">Past Due</option>
                                    </select>
                                </div>

                                <div class="col-auto px-2 d-none d-md-block">
                                    <select class="form-select" formControlName="year" (change)="filterStatus()">
                                        <option value="{{currentYear}}">{{currentYear}}</option>
                                        <option value="{{lastYear}}">{{lastYear}}</option>
                                    </select>
                                </div>

                                <div class="col-auto px-2 d-none d-md-block">
                                    <select class="form-select" formControlName="month" (change)="filterStatus()">
                                        <option value="0">Jan</option>
                                        <option value="1">Feb</option>
                                        <option value="2">Mar</option>
                                        <option value="3">Apr</option>
                                        <option value="4">May</option>
                                        <option value="5">Jun</option>
                                        <option value="6">Jul</option>
                                        <option value="7">Aug</option>
                                        <option value="8">Sep</option>
                                        <option value="9">Oct</option>
                                        <option value="10">Nov</option>
                                        <option value="11">Dec</option>
                                    </select>
                                </div>

                                <div class="col-auto p-0 pe-2">
                                    <!-- Button to Open the New Invoice Modal -->
                                    <button type="button" class="btn btn-primary mx-2" data-bs-toggle="modal"
                                        data-bs-target="#newInvoice" (click)="modalData = false"
                                        (click)="getCustomers()">
                                        <i class="bi bi-plus-lg"></i>
                                        <span class="d-none d-xl-inline ps-1">New</span>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="row p-2 pb-0 d-block d-md-none">
                        <form [formGroup]="filterFormInputs">
                            <div class="row ps-1 pb-0 pt-1">
                                <div class="col px-2 ">
                                    <select class="form-select" formControlName="status" (change)="filterStatus()">
                                        <option value="-1" selected>Status All</option>
                                        <option value="Paid">Paid</option>
                                        <option value="Partial">Partial</option>
                                        <option value="Past Due">Past Due</option>
                                    </select>
                                </div>

                                <div class="col-auto px-2">
                                    <select class="form-select" formControlName="year" (change)="filterStatus()">
                                        <option value="{{currentYear}}">{{currentYear}}</option>
                                        <option value="{{lastYear}}">{{lastYear}}</option>
                                    </select>
                                </div>

                                <div class="col-auto px-2 ">
                                    <select class="form-select" formControlName="month" (change)="filterStatus()">
                                        <option value="0">Jan</option>
                                        <option value="1">Feb</option>
                                        <option value="2">Mar</option>
                                        <option value="3">Apr</option>
                                        <option value="4">May</option>
                                        <option value="5">Jun</option>
                                        <option value="6">Jul</option>
                                        <option value="7">Aug</option>
                                        <option value="8">Sep</option>
                                        <option value="9">Oct</option>
                                        <option value="10">Nov</option>
                                        <option value="11">Dec</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>

                    @if(!tableSpinner){
                    <div class="scrollable mb-2">
                        @if(!displaySmall){
                        <!-- Table Section -->
                        <table mat-table [dataSource]="dataSource" class="mt-3 scrollable">

                            <!-- Invoice Status Column -->
                            <ng-container matColumnDef="invoiceStatus">
                                <mat-header-cell *matHeaderCellDef> Status </mat-header-cell>
                                <mat-cell *matCellDef="let element">
                                    {{element.invoiceStatus}}
                                </mat-cell>
                            </ng-container>

                            <!-- Invoice Num Column  -->
                            <ng-container matColumnDef="invoiceNum">
                                <mat-header-cell *matHeaderCellDef class="d-flex justify-content-center">#
                                </mat-header-cell>
                                <mat-cell *matCellDef="let element" class="d-flex justify-content-center">
                                    {{element.invoiceNumber}}
                                </mat-cell>
                            </ng-container>

                            <!-- Customer Name Column  -->
                            <ng-container matColumnDef="customerName">
                                <mat-header-cell *matHeaderCellDef class="d-flex justify-content-center"> Name
                                </mat-header-cell>
                                <mat-cell *matCellDef="let element" class="d-flex justify-content-center">
                                    {{element.customerName}}
                                </mat-cell>
                            </ng-container>

                            <!-- Total Column  -->
                            <ng-container matColumnDef="total">
                                <mat-header-cell *matHeaderCellDef class="d-flex justify-content-center"> Total
                                </mat-header-cell>
                                <mat-cell *matCellDef="let element" class="d-flex justify-content-center">
                                    ${{element.grandTotal | number:'1.2-2' }}
                                </mat-cell>
                            </ng-container>

                            <!-- Date Invoiced Colum -->
                            <ng-container matColumnDef="dateInvoiced">
                                <mat-header-cell *matHeaderCellDef class="d-flex justify-content-center"> Date Inv.
                                </mat-header-cell>
                                <mat-cell *matCellDef="let element" class="d-flex justify-content-center text-center">
                                    {{convertDate(element.day, element.month ,element.year)}}
                                </mat-cell>
                            </ng-container>

                            <!-- Balance Column  -->
                            <ng-container matColumnDef="balance">
                                <mat-header-cell *matHeaderCellDef class="d-flex justify-content-center"> Balance
                                </mat-header-cell>
                                <mat-cell *matCellDef="let element" class="d-flex justify-content-center">
                                    ${{element.invoiceBalance | number:'1.2-2' }}
                                </mat-cell>
                            </ng-container>


                            <!-- Due Date Column  -->
                            <ng-container matColumnDef="dueDate">
                                <mat-header-cell *matHeaderCellDef class="d-flex justify-content-center"> Due Date
                                </mat-header-cell>
                                <mat-cell *matCellDef="let element" class="d-flex justify-content-center">
                                    {{element.dueDate }}
                                </mat-cell>
                            </ng-container>

                            <!-- Options Column -->
                            <ng-container matColumnDef="options">
                                <mat-header-cell *matHeaderCellDef></mat-header-cell>
                                <mat-cell *matCellDef="let element" class="d-flex justify-content-end">
                                    <i class="bi bi-pencil-square hoverColor mx-2"
                                        (click)="modalInvoiceData(element)"></i>
                                </mat-cell>
                            </ng-container>

                            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                            <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>

                        </table>
                        }
                        @else{
                        <!-- Table Section -->
                        <table mat-table [dataSource]="dataSource" class="mt-3 scrollable">

                            <!-- Invoice Status Column -->
                            <ng-container matColumnDef="invoiceStatus">
                                <mat-header-cell *matHeaderCellDef> Status </mat-header-cell>
                                <mat-cell *matCellDef="let element">
                                    {{element.invoiceStatus}}
                                </mat-cell>
                            </ng-container>

                            <!-- Invoice Num Column  -->
                            <ng-container matColumnDef="invoiceNum">
                                <mat-header-cell *matHeaderCellDef class="d-flex justify-content-center">#
                                </mat-header-cell>
                                <mat-cell *matCellDef="let element" class="d-flex justify-content-center">
                                    {{element.invoiceNumber}}
                                </mat-cell>
                            </ng-container>

                            <!-- Customer Name Column  -->
                            <ng-container matColumnDef="customerName">
                                <mat-header-cell *matHeaderCellDef class="d-flex justify-content-center"> Name
                                </mat-header-cell>
                                <mat-cell *matCellDef="let element" class="d-flex justify-content-center">
                                    {{element.customerName}}
                                </mat-cell>
                            </ng-container>

                            <!-- Total Column  -->
                            <ng-container matColumnDef="total">
                                <mat-header-cell *matHeaderCellDef class="d-flex justify-content-center"> Total
                                </mat-header-cell>
                                <mat-cell *matCellDef="let element" class="d-flex justify-content-center">
                                    ${{element.grandTotal | number:'1.2-2' }}
                                </mat-cell>
                            </ng-container>

                            <!-- Balance Column  -->
                            <ng-container matColumnDef="balance">
                                <mat-header-cell *matHeaderCellDef class="d-flex justify-content-center"> Balance
                                </mat-header-cell>
                                <mat-cell *matCellDef="let element" class="d-flex justify-content-center">
                                    ${{element.invoiceBalance | number:'1.2-2' }}
                                </mat-cell>
                            </ng-container>


                            <!-- Options Column -->
                            <ng-container matColumnDef="options">
                                <mat-header-cell *matHeaderCellDef></mat-header-cell>
                                <mat-cell *matCellDef="let element" class="d-flex justify-content-end">
                                    <i class="bi bi-pencil-square hoverColor mx-2"
                                        (click)="modalInvoiceData(element)"></i>
                                </mat-cell>
                            </ng-container>

                            <mat-header-row *matHeaderRowDef="displayedColumnsSmall"></mat-header-row>
                            <mat-row *matRowDef="let row; columns: displayedColumnsSmall;"></mat-row>

                        </table>
                        }
                    </div>
                    }
                    @else {
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border m-5" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    }
                    <div class="row d-flex align-items-end">
                        <div class="col p-0">
                            <mat-paginator [pageSizeOptions]="[8]" hidePageSize class="p-0"></mat-paginator>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal For New Invoice  -->
<div class="modal fade" id="newInvoice" data-bs-backdrop="static" tabindex="-1" #newInvoiceModal>
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <form [formGroup]="invoiceForm">
                <div class="modal-body">
                    <div class="row">
                        <div class="col d-flex justify-content-end">
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                                (click)="clearNewInvoiceForm()"></button>
                        </div>
                    </div>

                    <div class="p-sm-12 p-4">
                        <div class="invoice-preview-header  p-4">
                            <div class="d-flex flex-wrap  flex-row justify-content-between ">
                                <!-- Logo and Address -->
                                <div class="col d-flex align-items-center gap-3 ">
                                    <img src="../../../assets/aceClosetLogoFull.png" alt="Logo" class="img-fluid"
                                        style="max-width: 100px;">
                                    <div>
                                        <p class="mb-1">#7 Panama Extension</p>
                                        <p class="mb-1">Belmopan City,</p>
                                        <p class="mb-1">Cayo, Belize</p>
                                        <p class="mb-0">+501 628-9704</p>
                                    </div>
                                </div>
                                <!-- Invoice Details -->
                                <div class="col col-md-12 col-lg-6 mt-4 mt-lg-0">
                                    <dl class="row mb-0 gx-4">
                                        <!-- Invoice ID -->
                                        <dt class="col-sm-5 mb-2 d-flex align-items-center">
                                            <span class="text-capitalize text-nowrap fs-5 fw-medium">Invoice</span>
                                        </dt>
                                        <dd class="col-sm-7">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text">#</span>
                                                <input type="number" class="form-control" readonly
                                                    formControlName="invoiceNumber" id="invoiceId">
                                            </div>
                                        </dd>
                                        <!-- Date Issued -->
                                        <dt class="col-sm-5 mb-2 d-flex align-items-center">
                                            <span class="fw-normal text-nowrap">Date Issued:</span>
                                        </dt>
                                        <dd class="col-sm-7">
                                            <div class="input-group input-group-sm">
                                                <input type="date" class="form-control" formControlName="dateIssued"
                                                    placeholder="MM/DD/YYYY" id="dateIssued">
                                            </div>
                                        </dd>
                                        <!-- Due Date -->
                                        <dt class="col-sm-5 d-flex align-items-center">
                                            <span class="fw-normal">Due Date:</span>
                                        </dt>
                                        <dd class="col-sm-7 mb-0">
                                            <div class="input-group input-group-sm">
                                                <input type="date" class="form-control" formControlName="dueDate"
                                                    placeholder="MM/DD/YYYY" id="dueDate">
                                            </div>
                                        </dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                        <div class="card-body pt-4">
                            <div class="row my-1">
                                <div class="col-md-6 col-sm-5 col-12 mb-sm-0 mb-4">
                                    <p class="fs-6 fw-medium">Invoice To:</p>
                                    <div class="row">
                                        <div class="col-lg-6 col-md-8 col-12">
                                            <select class="form-select" (change)='populateCustInv($event)'>
                                                <option selected disabled>Select Customer</option>
                                                @for (customer of activeUsers; track customer.name) {
                                                <option (value)="customer">{{ customer.name }}
                                                </option>
                                                } @empty {
                                                <option disabled>There Are No Customers</option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                    <div class="p-2 pb-0">
                                        @if(selectedInvoiceCustomer){
                                        <p class="mb-0">{{selectedInvoiceCustomer.name}}</p>
                                        <p class="mb-0">{{selectedInvoiceCustomer.shippingAddress?.street}}</p>
                                        <p class="mb-0">{{selectedInvoiceCustomer.shippingAddress?.cityTown}}</p>
                                        <p class="mb-0">{{selectedInvoiceCustomer.phoneNumber}}</p>
                                        <p class="mb-0">{{selectedInvoiceCustomer.email}}</p>
                                        }@else {
                                        <p class="mb-0"></p>
                                        }
                                    </div>
                                </div>
                                <div class="col-md-6 col-sm-7">
                                    <p class="fs-6 fw-medium">Bill To:</p>
                                    <div class="px-2">
                                        @if(selectedInvoiceCustomer){
                                        <p class="mb-0">{{selectedInvoiceCustomer.name}}</p>
                                        <p class="mb-0">{{selectedInvoiceCustomer.shippingAddress?.street}}</p>
                                        <p class="mb-0">{{selectedInvoiceCustomer.shippingAddress?.cityTown}}</p>
                                        <p class="mb-0">{{selectedInvoiceCustomer.phoneNumber}}</p>
                                        <p class="mb-0">{{selectedInvoiceCustomer.email}}</p>
                                        }@else {
                                        <p class="mb-0"></p>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="mt-3 mb-4">
                        <div class="itemCard pt-0 px-0">
                            <form class="source-item">
                                <div class="p-3 m-2">
                                    <div class="row">
                                        <div class="col-lg-6 col-12 pb-3">
                                            <p class="h6 ">Item</p>
                                            <select class="form-select item-details ">
                                                <option selected="" disabled="">App Design</option>
                                                <option value="App Customization">App Customization</option>
                                                <option value="ABC Template">ABC Template</option>
                                                <option value="App Development">App Development</option>
                                            </select>
                                        </div>
                                        <div class="col-lg col-6 pb-3">
                                            <p class="h6 ">Qty</p>
                                            <input type="text" class="form-control invoice-item-qty" placeholder="1"
                                                min="1" max="50">
                                        </div>
                                        <div class="col-lg col-6 pb-3">
                                            <p class="h6 ">Price</p>
                                            <input type="text" class="form-control invoice-item-qty" placeholder="12.50"
                                                min="1" max="50">
                                        </div>
                                        <div class="col-lg col-4 pb-3 text-center">
                                            <p class="h6 ">Total</p>
                                            <p class="mb-0 mt-2 text-heading">$24.00</p>
                                        </div>
                                        <div class="col-lg col-4 pb-3 text-center">
                                            <p class="h6 ">TAX</p>
                                            <p class="mb-0 mt-2 text-heading">12.5%</p>
                                        </div>
                                        <div class="col-lg-auto col-4 pb-3 d-flex align-items-center">
                                            <p class="mb-0 mt-2 text-heading"><i class="bi bi-x-lg"></i><i
                                                    class="bi bi-check2"></i></p>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <hr class="my-1">
                        <div class="card-body px-0">
                            <div class="row">
                                <div class="col-md-6 mb-md-0 mb-3">
                                    <div class="d-flex align-items-center mb-4">
                                        <label for="salesperson" class="me-2 h6 mb-2">Salesperson:</label>
                                        <input type="text" class="form-control" id="salesperson"
                                            placeholder="Tommy Shelby">
                                    </div>
                                    <input type="text" class="form-control" id="invoiceMsg"
                                        placeholder="Thanks for your business">
                                </div>
                                <div class="col-md-6 d-flex justify-content-md-end mt-2">
                                    <div class="invoice-calculations">
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="w-px-100">Subtotal:</span>
                                            <h6 class="mb-0">$1800</h6>
                                        </div>
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="w-px-100">Discount:</span>
                                            <h6 class="mb-0">$28</h6>
                                        </div>
                                        <div class="d-flex justify-content-between mb-1">
                                            <span class="w-px-100">Tax:</span>
                                            <h6 class="mb-0">21%</h6>
                                        </div>
                                        <hr class="my-2">
                                        <div class="d-flex justify-content-between">
                                            <span class="w-px-100">Total:</span>
                                            <h6 class="mb-0">$1690</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="my-1">
                        <div class="card-body px-0">
                            <div class="row">
                                <div class="col-12">
                                    <div class="mb-4">
                                        <label for="note" class="h6 fw-normal mb-2">Note:</label>
                                        <textarea class="form-control" rows="2" id="note"
                                            placeholder="Invoice note"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row py-2">
                        <div class="col d-flex justify-content-center">
                            <button type="button" class="btn btn-light mx-2" data-bs-dismiss="modal" aria-label="Close"
                                (click)="clearNewInvoiceForm()">Cancel</button>
                            <button class="btn btn-primary" (click)="modalData ? updateInvoice() : newInvoiceForm()"
                                [disabled]="invoiceForm.invalid">{{ modalData ? 'Update' : 'Save' }}</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>